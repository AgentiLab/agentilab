# ai-stock - AI Financial Analysis Engine

## Overview

ai-stock is an AI-powered financial analysis engine using Claude Sonnet 4 with comprehensive FMP API integration and advanced analysis capabilities. The application combines Claude's intelligence with professional financial tools to generate detailed reports and technical analysis.

## Key Features

### Frontend
- **Modern interface** inspired by Perplexity AI with clean design
- **Search bar** with glass-morphism effect and smooth animations
- **Real-time streaming** responses with typewriter effect
- **Markdown rendering** with `react-markdown` and `remark-gfm` for rich formatting
- **Elegant result cards** with verified sources
- **Dark/light mode** with smooth transitions
- **Responsive design** optimized for mobile and desktop
- **Subtle animations** with Framer Motion
- **Share functionality** - Create unique crystallized report links with "generated by AgentiLab" branding
- **Documentation page** - Comprehensive guide at /docs with accordion menus
- **Full English UI** - All interface elements, menus, and messages in English

### Backend
- **Claude Sonnet 4** via direct HTTP calls (Anthropic API) with SSE streaming
- **Agent architecture** where Claude autonomously uses tools
- **SerpAPI Integration** - Image search, Google Maps directions, Google Shopping products
- **Exa AI Integration** - Semantic web search and content crawling
- **Database** PostgreSQL for messages and shared reports

## Technical Architecture

### Stack
- **Frontend**: React 18 + TypeScript + Vite + Tailwind CSS + shadcn/ui + Framer Motion
- **Backend**: Node.js + Express + TypeScript
- **Database**: PostgreSQL (Neon)
- **AI**: Claude Sonnet 4 (via HTTP)
- **State Management**: TanStack Query v5

### Request Flow
For each user question:
1. **User submits question** - Sent to Claude agent
2. **Claude analyzes** - Uses tools autonomously as needed
3. **Real-time streaming** - Response streams back with typewriter effect
4. **Sources displayed** - Financial data and web sources shown

### Claude Tools
The AI agent can use the following tools:

#### FMP Financial Tools
- **get_company_profile** - Detailed company profile
- **get_income_statement** - Income statements
- **get_balance_sheet** - Balance sheet data
- **get_cash_flow** - Cash flow statements
- **get_key_metrics** - Key financial ratios and metrics
- **get_financial_ratios** - Comprehensive financial ratios
- **get_stock_quote** - Real-time stock quotes
- **get_historical_price** - Historical price data (OHLC)
- **search_companies** - Company search
- **get_stock_peers** - Comparable companies
- **get_financial_news** - Financial news
- **get_press_releases** - Company press releases
- **get_dividend_history** - Historical dividend payments
- **get_stock_split_history** - Historical stock splits
- Technical indicators: **RSI**, **MACD**, **EMA**, **SMA**, **ADX**, **Williams %R**, **CCI**, **Stochastic**

#### Macroeconomic & Calendar Tools
- **get_economic_calendar** - Economic events calendar (filters High/Medium impact)
- **get_earnings_calendar** - Company earnings calendar
- **get_ipo_calendar** - IPO schedule
- **get_treasury_rates** - US Treasury rates
- **get_economic_indicator** - GDP, unemployment, inflation, etc.
- **get_earnings_surprises** - Earnings surprises analysis
- **get_analyst_estimates** - Analyst estimates and consensus

#### Insider Trading Tools
- **get_insider_trading** - Insider trading transactions
- **get_insider_trade_statistics** - Insider trading statistics

#### Forex & Commodities Tools
- **get_forex_quote** - Forex pair quotes
- **get_forex_list** - Available forex pairs
- **get_commodity_quotes** - Commodity prices
- **get_cot_report** - Commitment of Traders report
- **get_cot_analysis** - COT report analysis

#### Advanced Analysis Tools
- **run_monte_carlo_simulation** - Monte Carlo simulation for return projections and risk analysis
  - Uses historical prices to simulate thousands of future scenarios
  - Calculates statistics (mean, median, percentiles, profit probability)
  - Displays Python code used for simulation
  - Interactive interface with Results/Code tabs

#### Web Search Tools
- **web_search_exa(query, options)** - Exa AI semantic web search for high-quality content
  - Search types: neural (semantic), keyword (exact), or auto
  - Category filters: company, research_paper, news_article, tweet, github, pdf
  - Domain filters (include/exclude specific sites)
  - Publication date filters
  - Includes page text in results
- **get_contents_exa(urls, options)** - Exa web crawling and content extraction
  - Full text extraction from specific pages
  - Generates highlights (key phrases)
  - Generates custom AI summaries
  - Perfect for deep-diving into URLs found via web_search_exa

#### SerpAPI Tools
- **image_search(query, limit)** - Image search via Google Images
- **map_directions(from, to)** - Routes and directions via Google Maps
- **google_shopping(query, limit)** - Product search on Google Shopping

## Configuration

### Required Environment Variables
- `ANTHROPIC_API_KEY` - Anthropic API key for Claude
- `EXA_API_KEY` - Exa API key for semantic web search and crawling
- `SERPAPI_API_KEY` - SerpAPI key for image search, maps, and shopping
- `FMP_API_KEY` - Financial Modeling Prep API key for financial data
- `DATABASE_URL` - PostgreSQL connection URL (auto-configured by Replit)

### Installation
```bash
npm install
npm run db:push  # Create database tables
npm run dev      # Start application
```

## API Endpoints

- `POST /api/chat` - Chat with Claude (SSE streaming)
  - SSE events: `status`, `text`, `tool_result`, `tools`, `sources`, `done`, `error`, `python_code`
- `POST /api/share` - Create shareable report
- `GET /api/share/:shareId` - Get shared report by ID

## Project Structure

```
├── client/
│   ├── src/
│   │   ├── components/      # Reusable React components
│   │   │   ├── streaming-answer.tsx   # Streaming response with markdown
│   │   │   ├── tool-results.tsx       # Display images, maps, products
│   │   │   ├── share-button.tsx       # Share functionality with triple-fallback
│   │   │   └── ...
│   │   ├── pages/          # Application pages
│   │   │   ├── home.tsx               # Main search interface
│   │   │   ├── shared-report.tsx      # Shared report viewer
│   │   │   └── documentation.tsx      # Comprehensive docs page
│   │   ├── hooks/          # Custom hooks
│   │   └── lib/            # Utilities
├── server/
│   ├── services/           # Backend services
│   │   ├── claudeService.ts       # Claude integration via HTTP
│   │   ├── serpapiService.ts      # SerpAPI (images, maps, shopping)
│   │   ├── exaService.ts          # Exa AI (web search + crawling)
│   │   ├── fmpService.ts          # Financial Modeling Prep API
│   │   ├── monteCarloService.py   # Monte Carlo simulation (Python)
│   │   └── pythonExecutor.ts      # Secure Python executor
│   ├── routes.ts           # API routes
│   ├── storage.ts          # Database abstraction layer
│   └── db.ts              # Database configuration
└── shared/
    └── schema.ts          # Drizzle schemas and TypeScript types
```

## Implementation Details

### Claude via HTTP (not SDK)
The application uses direct HTTP calls to `https://api.anthropic.com/v1/messages` instead of the Anthropic SDK, allowing full control over requests and SSE streaming.

### SSE Streaming
Claude responses are streamed in real-time via Server-Sent Events, providing a smooth user experience with typewriter effect.

### Markdown Rendering
- Claude responses are formatted in markdown
- Rendered with `react-markdown` and `remark-gfm` (GitHub Flavored Markdown)
- Custom styling for all elements: headings, lists, links, code, blockquotes
- Full dark mode support

### Share System
- Creates unique 8-character IDs for shared reports
- Stores complete report data: question, answer, tool results, sources
- Branded with "generated by AgentiLab" footer
- Triple-fallback clipboard system (modern API → execCommand → manual display)

### Navigation Pattern
- Uses `useLocation()` from wouter for navigation to avoid DOM nesting errors
- All interactive elements properly structured with valid HTML hierarchy

## Development

### Design Guidelines
See `design_guidelines.md` for complete design system specifications.

### Testing
The application uses `data-testid` attributes to facilitate e2e testing with Playwright.

## Notes
- Dark mode is the default theme
- Application binds to 0.0.0.0:5000
- "Start application" workflow runs `npm run dev`
- Full English UI across all interfaces
