# ProfileAI - Agent de Profilage Automatique de Personnes

## Vue d'ensemble

**ProfileAI** est un agent IA intelligent propuls√© par Claude Sonnet 4 qui g√©n√®re automatiquement des fiches de profil professionnelles et compl√®tes pour n'importe quelle personne. L'application orchestre plusieurs sources de donn√©es (Tavily Search, SerpAPI, Google Scholar) pour cr√©er des profils riches avec photo, biographie, r√©seaux sociaux avec m√©triques, publications acad√©miques, entreprises fond√©es, et prix/r√©compenses.

**Fonctionnalit√© principale** : Profilage automatique - Entrez simplement un nom (ex: "Elon Musk") et obtenez instantan√©ment une fiche ultra compl√®te avec :
- üì∏ Photo de profil professionnelle
- üìù Biographie d√©taill√©e
- üåê Liens vers tous les r√©seaux sociaux (Twitter, LinkedIn, GitHub, Medium, TikTok, Twitch, etc.) avec m√©triques en temps r√©el
- üèÜ Prix et r√©compenses
- üè¢ Entreprises fond√©es ou dirig√©es
- üìö Publications acad√©miques avec citations
- üîó Sites web pertinents

**Design AgentiLab** : L'application utilise le syst√®me de design AgentiLab avec une palette de couleurs professionnelle, une typographie moderne (Space Grotesk + Inter), des animations Framer Motion fluides, et une approche dark-first pour une exp√©rience utilisateur premium.

## Fonctionnalit√©s principales

### Frontend
- **Interface moderne** inspir√©e de Perplexity AI avec design √©pur√©
- **Barre de recherche** avec effet glass-morphism et animations fluides
- **Streaming en temps r√©el** des r√©ponses avec effet typewriter
- **Affichage du processus** de recherche avec les 5 requ√™tes g√©n√©r√©es (collapsible pour ne pas bloquer la vue)
- **Indicateur de progression** en temps r√©el avec compteur de requ√™tes termin√©es (ex: 3/5)
- **Rendu markdown** avec `react-markdown` et `remark-gfm` pour un formatage riche
- **Cartes de r√©sultats** √©l√©gantes avec citations et sources v√©rifi√©es
- **Mode sombre/clair** avec transitions fluides
- **Design responsive** optimis√© mobile et desktop
- **Animations** subtiles avec Framer Motion

### Backend
- **Claude Sonnet 4** via appels HTTP directs (API Anthropic) avec SSE streaming
- **Architecture d'agent** o√π Claude utilise des outils autonomes
- **Workflow intelligent** : g√©n√©ration de 5 requ√™tes optimis√©es par question
- **Recherche web** Tavily AI Search pour r√©sultats de haute qualit√©
- **Web crawler** avec Cheerio pour extraction de contenu
- **Embeddings vectoriels** avec OpenAI text-embedding-3-large (3072 dimensions)
- **Recherche s√©mantique** avec PostgreSQL et extension pgvector
- **SerpAPI Integration** : recherche d'images, itin√©raires Google Maps, produits Google Shopping
- **Base de donn√©es** PostgreSQL avec tables crawledPages, embeddings, messages, personProfiles

## Architecture technique

### Stack
- **Frontend**: React 18 + TypeScript + Vite + Tailwind CSS + shadcn/ui + Framer Motion
- **Backend**: Node.js + Express + TypeScript
- **Database**: PostgreSQL (Neon) avec extension pgvector
- **AI**: Claude Sonnet 4 (via HTTP), OpenAI embeddings
- **State Management**: TanStack Query v5

### Workflow de recherche
Pour chaque question utilisateur :
1. **G√©n√©ration de requ√™tes** : Claude g√©n√®re 5 requ√™tes de recherche optimis√©es
2. **Recherche Tavily** : Chaque requ√™te est envoy√©e √† Tavily AI Search
3. **Affichage en temps r√©el** : Les r√©sultats apparaissent au fur et √† mesure
4. **Synth√®se** : Claude analyse tous les r√©sultats et g√©n√®re une r√©ponse markdown

### Outils de Claude
L'agent IA peut utiliser les outils suivants (tous sont activement utilis√©s par Claude selon le contexte):

**Outils de base:**
1. **web_search(query)** - Recherche Tavily AI
2. **web_crawl(url)** - Extraction de contenu web
3. **query_vector(query)** - Recherche s√©mantique dans les contenus index√©s (PostgreSQL pgvector)

**Outils SerpAPI:**
4. **image_search(query, limit)** - Recherche d'images via Google Images
5. **map_directions(from, to)** - Itin√©raires et directions via Google Maps
6. **google_shopping(query, limit)** - Recherche de produits sur Google Shopping
7. **finance_data(query)** - Donn√©es financi√®res et cours de bourse via Google Finance
8. **job_search(query, location)** - Recherche d'emplois via Google Jobs
9. **flight_search(from, to, date)** - Recherche de vols via Google Flights
10. **hotel_search(location, check_in, check_out)** - Recherche d'h√¥tels via Google Hotels
11. **video_search(query, limit)** - Recherche de vid√©os (YouTube, etc.)
12. **google_trends(query)** - Donn√©es de tendances de recherche Google
13. **google_scholar(query, limit)** - Recherche d'articles acad√©miques
14. **app_store_search(query, limit)** - Recherche d'applications iOS sur App Store

**Outil de profilage:**
15. **person_profile_search(name, additional_context)** - G√©n√®re un profil complet d'une personne (photo, bio, occupation, r√©seaux sociaux avec m√©triques, publications). Orchestre automatiquement Tavily search, SerpAPI images et Google Scholar.

## Configuration

### Variables d'environnement requises
- `ANTHROPIC_API_KEY` - Cl√© API Anthropic pour Claude
- `TAVILY_API_KEY` - Cl√© API Tavily pour recherche web
- `OPENAI_API_KEY` - Cl√© API OpenAI pour embeddings
- `SERPAPI_API_KEY` - Cl√© API SerpAPI pour recherche d'images, maps et shopping
- `DATABASE_URL` - URL de connexion PostgreSQL (auto-configur√© par Replit)

### Installation
```bash
npm install
npm run db:push  # Cr√©er les tables de base de donn√©es
npm run dev      # D√©marrer l'application
```

## Endpoints API

- `POST /api/search` - Recherche web Tavily
- `POST /api/crawl` - Crawling de pages web
- `POST /api/query` - Recherche vectorielle s√©mantique
- `POST /api/chat` - Chat avec Claude (SSE streaming)
  - √âv√©nements SSE : `status`, `search_queries`, `search_progress`, `search_result`, `text`, `tool_result`, `sources`, `done`, `error`

## Structure du projet

```
‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/      # Composants React r√©utilisables
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ streaming-answer.tsx   # R√©ponse streaming avec markdown
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tool-results.tsx       # Affichage images, maps, produits
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/          # Pages de l'application
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/          # Hooks personnalis√©s
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/            # Utilitaires
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ services/           # Services backend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ claudeService.ts       # Int√©gration Claude via HTTP + g√©n√©ration de requ√™tes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tavilyService.ts       # Recherche web Tavily
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crawlerService.ts      # Web scraping
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embeddingService.ts    # OpenAI embeddings
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vectorService.ts       # Recherche vectorielle
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serpapiService.ts      # SerpAPI (images, maps, shopping)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ personProfileService.ts # Profilage de personnes (orchestration)
‚îÇ   ‚îú‚îÄ‚îÄ routes.ts           # Routes API
‚îÇ   ‚îú‚îÄ‚îÄ storage.ts          # Couche d'abstraction database
‚îÇ   ‚îî‚îÄ‚îÄ db.ts              # Configuration database
‚îî‚îÄ‚îÄ shared/
    ‚îî‚îÄ‚îÄ schema.ts          # Sch√©mas Drizzle et types TypeScript
```

## Particularit√©s d'impl√©mentation

### Claude via HTTP (non SDK)
L'application utilise des appels HTTP directs √† `https://api.anthropic.com/v1/messages` au lieu du SDK Anthropic, permettant un contr√¥le total sur les requ√™tes et le streaming SSE.

### Streaming SSE
Les r√©ponses de Claude sont stream√©es en temps r√©el via Server-Sent Events, offrant une exp√©rience utilisateur fluide avec effet typewriter.

### Embeddings vectoriels
- Mod√®le: `text-embedding-3-large` (3072 dimensions)
- Stockage: PostgreSQL avec extension pgvector
- Similarit√©: Distance cosinus pour recherche s√©mantique
- Note: Le contenu crawl√© est automatiquement tronqu√© si > 8192 tokens pour respecter la limite du mod√®le

### Rendu markdown
- Les r√©ponses de Claude sont format√©es en markdown
- Rendu avec `react-markdown`, `remark-gfm` (GitHub Flavored Markdown) et `remark-breaks` (line breaks)
- **Preprocessing Unicode** : Correction automatique des headings mal format√©s avec regex Unicode `/([^\s\n])(#{1,6} )(?=[\p{Lu}\p{Lt}\p{Nd}\p{Emoji}])/gu` (@ts-ignore pour compatibilit√© TypeScript)
  - G√®re 95% des cas : majuscules (A-Z), majuscules accentu√©es (√Ä, √â, ≈í), nombres (0-9), emojis
  - S√©pare "text# R√©sum√©" en "text\n\n# R√©sum√©" pour un rendu correct
  - Limitation connue : ne d√©tecte pas les headings commen√ßant par minuscule (ex: "text# heading") pour √©viter les faux positifs sur les hashtags inline
- Styling personnalis√© pour tous les √©l√©ments : headings, listes, liens, code, blockquotes
- Support complet du mode sombre

## Th√®me AgentiLab

L'application utilise le syst√®me de design AgentiLab pour une identit√© visuelle professionnelle et moderne.

### Couleurs principales
- **Primary Blue**: #3B82F6 (217 91% 60%) - Couleur de marque principale
- **Accent Teal**: #14B8A6 (174 69% 35%) - Accent pour badges tech et √©tats actifs
- **Dark-first**: Mode sombre par d√©faut avec backgrounds riches (210 6% 10%)
- **Semantic colors**: Success (green), Warning (amber), Destructive (red)

### Typographie
- **Display**: Space Grotesk - Pour les titres et textes d'impact (H1-H3)
- **Sans**: Inter - Pour le corps de texte et l'interface
- **Mono**: JetBrains Mono - Pour le code et donn√©es techniques

### Charts & Data Viz
- Chart 1: Dark Blue (217 91% 35%)
- Chart 2: Teal (174 69% 35%) - Accent AgentiLab
- Chart 3: Green (142 76% 36%) - Success
- Chart 4: Amber (38 92% 40%) - Warning
- Chart 5: Purple (262 83% 45%)

## D√©veloppement

### Guidelines de design
Voir `design_guidelines.md` pour les sp√©cifications compl√®tes du design system.

### Tests
L'application utilise des attributs `data-testid` pour faciliter les tests e2e avec Playwright.

## Am√©liorations r√©centes

### Partage de r√©sultats (Octobre 2025)
- **Liens de partage uniques** : Cristallisation des r√©sultats de recherche dans un lien partageable permanent
- **Bouton de partage int√©gr√©** : Bouton principal apr√®s chaque recherche pour cr√©er et copier automatiquement le lien
- **Page d√©di√©e de visualisation** : Interface en lecture seule avec mention "Generated by AgentiLab"
- **Stockage persistant** : Sauvegarde compl√®te de la question, r√©ponse, sources et r√©sultats d'outils (images, maps, etc.)
- **UX optimale** : Copie automatique du lien dans le presse-papier avec notification toast

### UX optimis√©e (Octobre 2024)
- **Search Queries Collapsibles** : Les requ√™tes de recherche sont maintenant dans un panneau repliable pour ne pas bloquer la vue pendant la recherche
- **Indicateur de progression visible** : Barre de statut toujours visible avec animation de chargement
- **Compteur de progression** : Affichage du nombre de requ√™tes termin√©es (ex: "3/5") dans l'en-t√™te du panneau
- **UX non-intrusive** : L'utilisateur peut voir le processus sans √™tre g√™n√© par des bo√Ætes vides qui occupent l'espace

## Notes
- Dark mode est le th√®me par d√©faut AgentiLab (avec toggle pour light mode)
- L'application bind sur 0.0.0.0:5000
- Le workflow "Start application" ex√©cute `npm run dev`
- **Toutes les fonctionnalit√©s sont utilis√©es** : Vector embedding, SerpAPI tools, Tavily search - aucun code mort
